\documentclass[runningheads]{llncs}
\usepackage[T1]{fontenc}
% \usepackage{graphicx}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{booktabs}

\renewcommand\UrlFont{\color{blue}\rmfamily}

\newcommand{\vangiang}[1]{\textcolor{magenta}{#1}}
\newcommand{\sylvain}[1]{\textcolor{teal}{#1}}

\newcommand{\bbbb}{{\rm I\!B}}

\begin{document}
%
\title{Minimal trap-spaces of Logical models are maximal siphons of their Petri net encoding}
\titlerunning{Minimal trap-spaces as maximal siphons}
\author{Van-Giang Trinh\inst{1}\orcidID{0000-0001-6581-998X} \and \\
  Sylvain Soliman\inst{2}\orcidID{0000-0001-5525-7418}}
% \authorrunning{F. Author et al.}

\institute{
  Aix-Marseille Université, Marseille, France\\
  \email{Trinh.Van-Giang@lis-lab.fr}
  \and
  Lifeware team, Inria Saclay center, Palaiseau, France\\
  \email{Sylvain.Soliman@inria.fr}%\\
  %\url{http://lifeware.inria.fr/~soliman/}
}

\maketitle

\begin{abstract}
  % The abstract should briefly summarize the contents of the paper in
  % 150--250 words.

  Boolean modelling has proven over the years that it can bring powerful analyses and corresponding insight to the many cases where precise biological data is not sufficiently available to build a detailed quantitative model.
  This is even more true for very big models where such data is frequently missing and led to a constant increase in size of logical models \emph{à la} Thomas.
  The analysis of such models is mostly based on attractor computation, since those correspond roughly to \emph{phenotypes}, and the recent use of trap-spaces made a real breakthrough in that domain allowing to consider medium-sized models that used to be out of reach.
  However, with the continuing increase in model-size, the state of the art computation of minimal trap-spaces based on prime-implicants shows its limits as there can be very many such implicants.
  In this article we present an alternative method to compute minimal trap-spaces, and hence complex attractors, that relies on a completely different technique, namely the enumeration of maximal siphons in the Petri net encoding of the original Logical model.
  We then demonstrate its efficiency and compare it to implicant-based methods on a few relevant big Boolean models.

\keywords{Logical models \and Boolean models \and Trap-spaces \and Attractor computation \and Petri nets \and Siphons}
\end{abstract}

\section{Introduction}

\sylvain{We could go for a completely different title, e.g., focused on performance much more, like ``Scaling-up attractor computation for Logical models''}

From the observation that the transcriptional regulation behaved in a sigmoid step-like way, came the original idea to represent models of gene regulation as discrete event systems.
Those Gene Regulation Networks (GRN) use thresholds or equivalently logical functions to represent the different regulations~\cite{glass1973logical,thomas1973boolean,thomas1990biological,thomas1991regulatory}.

Boolean modelling has proven over the years that it can bring powerful analyses and corresponding insight to the many cases where precise biological data is not sufficiently available to build a detailed quantitative model~\cite{wang2012boolean}.
This is even more true for very big models where such data is frequently missing and led to a constant increase in size of logical models \emph{à la} Thomas~\cite{aghamiri2020automated}.
The analysis of such models is mostly based on attractor computation, since those correspond roughly to \emph{phenotypes}, and the recent use of trap-spaces~\cite{klarner2015computing} made a real breakthrough in that domain allowing to consider medium-sized models that used to be out of reach.
However, with the continuing increase in model-size, the state of the art computation of minimal trap-spaces based on \emph{prime-implicants} shows its limits as there can be a huge number of such implicants.

Petri nets were introduced in the 60’s as a simple formalism for describing and analyzing information processing systems that are characterized as being concurrent, asynchronous, non-deterministic and possibly distributed~\cite{peterson1981petri,Murata1989}.
The use of Petri nets for representing biochemical reaction systems, by mapping molecular species to places and reactions to transitions, was introduced quite late in~\cite{reddy1993petri}, together with some Petri net concepts and tools for the analysis of metabolic networks.
Siphons are such a concept but they have not been used a lot for the analysis of biochemical systems even if the practical cost of computing their minimal/maximal elements appear much more manageable than the theoretical complexity would indicate~\cite{nabli2016enumerating}.

In this article we present an alternative method to compute minimal trap-spaces, and hence complex attractors, that replaces the need for prime-implicants by a completely different technique, namely the enumeration of maximal siphons in the Petri net encoding of the original Logical model.
We then demonstrate its efficiency and compare it to implicant-based methods on a few relevant big Boolean models.

\section{Preliminaries}

TBD.
Purely Boolean for trap-spaces, asynchronous for encoding.

\subsection{Traps-spaces}

We recall here some definitions from~\cite{klarner2015computing} for the introduction of \emph{trap-spaces}.
Minimal trap-spaces prove to be a very good approximation of the attractors of a Boolean model and have become the \emph{de facto} standard way to analyze models of a few tens of \emph{genes}~\cite{klarner2017pyboolnet,cifuentes2020control}.

Given a Boolean model \(\mathcal{M} = (V, F)\) with variables \(V=(v_{1},\dots,v_{n})\) and Boolean functions \(F=(f_{1},\dots,f_{n})\), its state-space is \(\mathcal{S}_{\mathcal{M}} =\bbbb^{n}\) with \(\bbbb = \{0, 1\}\).

%%% Subspace %%%
A \emph{subspace} \(m\) of \(\mathcal{S}_{\mathcal{M}}\) is characterized by its fixed variables (denoted by \(D_m\)) and free variables.
This subspace can be specified by an assignment \(D_m \mapsto \bbbb\), also denoted by \(m\) by abuse of notation, and where \(D_m \subseteq V\) and \(m(u)\) is the value of node \(u \in D_m\).
The remaining variables of \(\mathcal{M}\), \(V \setminus D_m\), are said to be \emph{free}, i.e., they can receive any Boolean value.
We write subspaces like states but use in addition the symbol \(\star\) to indicate that a variable is free.
A subspace \(m\) thus corresponds to the set of states \(\mathcal{S}_{\mathcal{M}}[m] := \{s \in \mathcal{S}_{\mathcal{M}}\;|\;\forall x_i \in D_m : s_i = m(x_i)\}\).
For example, \(m = \star\star1\) means that \(D_m = \{x_3\}\), \(m(x_3) = 1\), and corresponds to the set of states \(\{001, 011, 101, 111\}\).
Let \(\mathcal{S}_{\mathcal{M}}^{\star}\) denote the set of all possible subspaces of \(\mathcal{M}\). Note that \(\left|\mathcal{S}_{\mathcal{M}}^{\star}\right| = 3^n\) and \(S_{\mathcal{M}} \subset \mathcal{S}_{\mathcal{M}}^{\star}\)~\cite{klarner2015computing}.

%%% Minimal trap space and example %%%
A \emph{trap space} is defined as a subspace that is also a trap set.
Then, we define a partial order \(<\) on \(\mathcal{S}_{\mathcal{M}}^{\star}\) as: \(m < m'\) if and only if \(\mathcal{S}_{\mathcal{M}}[m] \subseteq \mathcal{S}_{\mathcal{M}}[m']\) and \(\mathcal{S}_{\mathcal{M}}[m] \neq \mathcal{S}_{\mathcal{M}}[m']\).
Consequently, a trap space \(m\) is minimal if and only if there is no trap space \(m' \in \mathcal{S}_{\mathcal{M}}^{\star}\) such that \(m' < m\).
For example, the BN shown in Example~\ref{example:BN} has all two trap spaces, \(m_1 = 11\) and \(m_2 = \star\star\). Since \(m_1 < m_2\), \(m_1\) is a minimal trap space of the BN.

\sylvain{missing example?}

\subsection{Petri net encoding of Logical models}
\label{sec:encoding}

\begin{definition}

  A \emph{Petri net graph} is a weighted bipartite directed graph \((P, T, W)\),
  where \(P\) is a non-empty finite set of vertices called \emph{places},
  \(T\) is a non-empty finite set of vertices called \emph{transitions},
  \(P \cap T = \emptyset\),
  and \(W : (P \times T) \cup (T \times P) \mapsto \bbbn \) is a weight function attached to the arcs.

\end{definition}

We will write \(pred(x)\) (resp.\ \(succ(x)\)) to represent the set of vertices that have an (non-zero weighted) arc leading to (resp.\ coming from) \(x\).

The link between Logical models \emph{à la} Thomas and Petri nets was originally established in~\cite{chaouiya2004qualitative} in order to make available formal methods like model-checking for the analysis of such systems.
The basic encoding into 1-safe (i.e., never more than one token in each place) nets only holds for purely Boolean models but was later extended to multi-valued models in two ways, either in \cite{chaouiya2011petri} with non 1-safe Petri nets or more recently in~\cite{chatain2014characterization} with 1-safe nets but many more places.

Since our study is focused on Boolean models, we briefly recall the original encoding here.
Its basis is that every \emph{gene} of the original model is represented by two separate places (\(p\) and \(\overline{p}\)), corresponding to its two states, active, and inactive.
Each conjunct of the logical function that activate the \emph{gene} will lead to a transition, consuming the inactive place, producing the active place, and with all other literals both consumed and produced.
And conversely for the inactivation.

The main property of this encoding is that it is completely faithful w.r.t.\ the asynchronous semantics.
Asynchronous transitions of the original model correspond one-to-one with firings of transitions in the Petri net.


Note that given a Logical model in the standard SBML-Qual format~\cite{chaouiya2013sbml}, i.e., one of the packages of SBML v3~\cite{keating2020sbml}, one can easily obtain its Petri net encoding in the PNML\footnote{\url{https://www.pnml.org/}} standard using the BioLQM\footnote{\url{http://www.colomoto.org/biolqm/}} library.
This piece of software extracted from GINsim~\cite{chaouiya2012logical} and part of the CoLoMoTo\footnote{\url{http://colomoto.org/}} software suite allows for easy conversion between standard formats.
It also accepts many other common formats for Logical models, notably the \verb|.bnet| files of the  BoolNet~\cite{mussel2010boolnet,klarner2017pyboolnet} tools.

Conversion is executed as follows:

\noindent{\small \verb|java -jar GINsim.jar -lqm <input.{sbml,bnet,zginml,...}> <output.pnml>|}

\subsection{Siphons}

Siphons are a classical property of place-transition nets~\cite{peterson1981petri}.
Note however that the use of siphons for the analysis of biological models, though it is not new, has been mostly relevant to the ODE-based continuous semantics of Chemical Reaction Networks~\cite{angeli2007petri,angeli2011persistence,degrand2020graphical}.

We recall here the basic definition establishing that to produce something in a siphon you must consume something from the siphon:

\begin{definition}

  A \emph{siphon} of a Petri net \((P, T, W)\) is a set of places \(S\) such that:
  \[\forall t\in T, S\cap succ(t)\not =\emptyset\Rightarrow S\cap pred(t)\not =\emptyset\]

\end{definition}

Intuitively a siphon is a set of places that once empty remains empty.

We add a definition related to any set of places of a Petri net encoding a Logical model, and notably a siphon of such a net.

\begin{definition}

  A set of places of Petri net \(P\) encoding logical model \(\mathcal{M}\) is \emph{conflict-free} if it does not contain any two places corresponding to the active and inactive states of the same \emph{gene} of \(\mathcal{M}\).

\end{definition}

\section{Minimal trap spaces as maximal conflict-free siphons}

\begin{definition}

  Let \(m\) be a subspace of Boolean model \(\mathcal{M}\). A \emph{mirror} of $m$ is a set of places $S$ in the Petri net encoding \(\mathcal{P}\) of \(\mathcal{M}\) such that:
  \[\forall v \in D_m, m(v) = 0 \Leftrightarrow p_v \in S, m(v) = 1 \Leftrightarrow \overline{p}_v \in S\]

\end{definition}

\begin{theorem}

  Let \(\mathcal{M}\) be a Boolean model and \(\mathcal{P}\) be its Petri net encoding. A subspace \(m\) is a trap space of \(\mathcal{M}\) if and only if its mirror \(S\) is a conflict-free siphon of \(\mathcal{P}\).

\end{theorem}

Intuitively, a siphon is a set of places that once empty remains so.
If it is conflict-free then its dual corresponds to a partial-state of the model such that whatever update, the fixed values remain so (since the empty places remain empty).
This is precisely the definition of a trap-space and maximality of the siphon is equivalent to as many fixed values as possible, hence minimality of the trap-space.

\begin{proof}

  TBD\qed

\end{proof}

\begin{theorem}
\label{theo:min_ts_max_sp}
  %\(S\) is a minimal trap-space of Boolean model \(\mathcal{M}\) if and only if the places corresponding to the fixed values in \(S\) (active or inactive) are a maximal conflict-free siphon of \((P, T, W)\), the Petri net encoding of \(S\).

  Let \(\mathcal{M}\) be a Boolean model and \(\mathcal{P}\) be its Petri net encoding. A subspace \(m\) is a minimal trap space of \(\mathcal{M}\) if and only if its mirror \(S\) is a maximal conflict-free siphon of \(\mathcal{P}\).

\end{theorem}

By Theorem~\ref{theo:min_ts_max_sp}, we can reduce the problem of computing all minimal trap spaces of a Boolean model to the problem of computing all maximal conflict-free siphons of its Petri net encoding. It is noted that there are no existing methods specifically designed for computing maximal conflict-free siphons (even maximal siphons) of a Petri net. The reason is that researchers mainly focus on minimal siphons~\cite{DBLP:journals/isci/LiuB16}. Hence, we here propose a new method based on Answer Set Programming (ASP)~\cite{DBLP:journals/aicom/GebserKKOSS11} for computing  maximal conflict-free siphons of a Petri net. The details of the proposed method shall be shown in the next section.

\section{Answer set programming-based method}

ASP

\section{Evaluation}
To assess the efficiency of the proposed method, we compared it with the state-of-the-art method PyBoolNet~\cite{klarner2017pyboolnet}.
We used a set of real-world Boolean models lying in various scales obtained from the literature.
These models are quite big (in size), complex (i.e., having high average in-degree, which is related to the number of prime-implicants) and most of them have never been fully analyzed.
We then applied the proposed method and PyBoolNet to computing minimal trap spaces of these real-world models.
To solve the ASP problems, we used the same ASP solver CLINGO~\cite{DBLP:journals/aicom/GebserKKOSS11} and the same configuration as that used in PyBoolNet~\cite{klarner2015computing}.
Specifically, ...
Finally, we set a time limit as one hour for each model.

\sylvain{we need a source for the models as much as possible, or to refer to some place where people can access them to reproduce the benchmark.}

\subsection{Benchmark vs.\ implicant-based methods}

Table~\ref{tab:result_real} shows the experimental results on real-world models. Hereafter, we analyze in detail the results with respect to minimal trap space computation.

\begin{table}[!ht]
  \caption{Timing comparisons between the proposed method and PyBoolNet on the selected real-world models.
    Columns "\(n\)", "\(e\)", and "\(s\)" denote the numbers of nodes, interactions, and source nodes of each model, respectively.
    Column "\(|M|\)" denotes the number of minimal trap spaces.
    The computation times are all in seconds.
    "DNF" means that the method did not finish the computation within one hour.}
  \label{tab:result_real}
  \begin{tabular}{lrrrrrrrrr}
    \toprule
    & & & & & & \multicolumn{2}{c}{PyBoolNet} & \multicolumn{2}{c}{Proposed method}\\
    \cmidrule(lr){7-8}\cmidrule(lr){9-10}
    model & $n$ & $e$ & $s$ & $|M|$ & $|F|$ & t1 (s) & t2 (s) & t1 (s) & t2 (s) \\ \midrule
    CASCADE-3~\cite{Tsirvouli2020} & 183 & - & 0 & 1 & 0 & - & - & 1.65 & - \\
    CHO-2016 & 200 & - & 13 & 1024 & 0 & - & - & 2.10 & - \\
    CACC~\cite{DBLP:journals/bmcsb/HelikarKMBRMWSLR12} & 70 & 153 & 1 & 10 & 2 & - & - & 0.18 & - \\
    THIL\_17 & 92 & - & 16 & 5724 & 5724 & - & - & 0.90 & - \\
    ERBB & 247 & 1100 & 22 & 1456394+ & 0 & DNF & DNF & DNF & - \\
    ER-STRESS & 182 & 266 & 75 & 25600 & 25600 & - & - & 4.54 & - \\
    AD~\cite{aghamiri2020automated} & 1169 & - & 469 & 49152 & 49152 & - & - & 66.17 & - \\
    Cholocystokinin~\cite{aghamiri2020automated} & 404 & - & 95 & 705024 & 705024 & - & - & 1080.35 & - \\
    FIBROBLASTS~\cite{helikar2008emergent} & 139 & 557 & 9 & 375850 & 32768 & - & - & 331.87 & - \\
    TcellCheckPoint & 218 & - & 34 & 15360 & 10240 & - & - & 4.33 & - \\
    HIV-1~\cite{DBLP:journals/bmcsb/HelikarKMBRMWSLR12} & 138 & 368 & 14 & 1408 & 1408 & DNF & DNF & 1.44 & - \\
    HMOX1~\cite{ostaszewski2021covid19} & 145 & 228 & 56 & 5120 & 5120 & - & - & 0.99 & - \\
    Human network & 1953 & - & 675 & 2048 & 2048 & DNF & DNF & 1770.98 & - \\
    IL\_6 Signalling~\cite{DBLP:journals/bmcsb/HelikarKMBRMWSLR12} & 86 & 149 & 15 & 512 & 448 & - & - & 0.32 & - \\
    IMMUNE-SYS & 164 & 506 & 13 & 36852 & 27871 & DNF & DNF & 14.19 & - \\
    IBD~\cite{DBLP:journals/bmcsb/HelikarKMBRMWSLR12} & 47 & 287 & 0 & 1 & 0 & DNF & DNF & 296.23 & - \\
    Influenza A~\cite{DBLP:journals/bmcsb/HelikarKMBRMWSLR12} & 131 & 302 & 11 & 2560 & 2560 & - & - & 1.07 & - \\
    INTERFERON-1~\cite{ostaszewski2021covid19} & 121 & 190 & 55 & 512 & 512 & - & - & 0.43 & - \\
    KORKUT-2015 & 99 & - & 12 & 2060 & 1384 & DNF & DNF & 2.86 & - \\
    KY-PA & 150 & 304 & 72 & 512 & 512 & - & - & 3.79 & - \\
    RA Apoptosis~\cite{aghamiri2020automated} & 431 & - & 59 & 640 & 0 & DNF & DNF & 0.70 & - \\
    CELL CYCLE 2020 & 121 & 493 & - & 78 & 78 & - & - & 3.72 & - \\
    S1\_Table & 1659 & - & 522 & 1024 & 1024 & DNF & DNF & 1511.07 & - \\
    Macrophage\_Act~\cite{DBLP:journals/bmcsb/HelikarKMBRMWSLR12} & 321 & 533 & 19 & 512 & 384 & - & - & 1.58 & - \\
    SIPC~\cite{Montagud2021} & 133 & 431 & 0 & 812 & 746 & - & - & 1.40 & - \\
    SPBP & 66 & 139 & 13 & 512 & 256 & - & - & 0.17 & - \\
    SN5~\cite{kim2013rmod} & 2746 & - & 835 & 2048 & 2048 & DNF & DNF & 3094.04 & - \\
    TCR-TLR5-SIG & 130 & 273 & 2 & 48 & 48 & - & - & 0.50 & - \\
    TLGLSurvival~\cite{DBLP:journals/bmcsb/HelikarKMBRMWSLR12} & 61 & 193 & 7 & 318 & 172 & - & - & 0.24 & - \\
    TUREI-2016 & 4691 & - & 1257 & - & - & DNF & DNF & DNF & DNF \\
    VIRUS-RE-CYC & 154 & 268 & 25 & 1024 & 1024 & - & - & 0.67 & - \\ \bottomrule
  \end{tabular}

\sylvain{I changed the ``look'' of the table using booktabs, see \url{https://nhigham.com/2019/11/19/better-latex-tables-with-booktabs/} for instance.}

\sylvain{what is $|F|$? what are t1 and t2? why are there no times for BoolNet?}
\end{table}

\subsection{Detailed biological example}

TBD

\section{Conclusion}

Future work: comparison with SAT/MaxSAT based approaches~\cite{nabli2016enumerating}

Also to a BDD-based approach using BioLQM is proposed at \url{http://colomoto.org/biolqm/doc/tools-trapspace.html} but because of the BDD conversion, some models are not even loaded.
This is also an issue for using BioLQM as a translator/preprocessor and since we do not use BDDs we might rely on writing our own parser for SBML-Qual and such formats.

\subsubsection{Acknowledgments}
Coffee is good, you should drink some!

\bibliographystyle{splncs04}
\bibliography{cmsb22.bib}

\end{document}

% \noindent Displayed equations are centered and set on a separate
% line.
% \begin{equation}
% x + y = z
% \end{equation}
% Please try to avoid rasterized images for line-art diagrams and
% schemas. Whenever possible, use vector graphics instead (see
% Fig.~\ref{fig1}).

% \begin{figure}
% % \includegraphics[width=\textwidth]{fig1.eps}
% \caption{A figure caption is always placed below the illustration.
% Please note that short captions are centered, while long ones are
% justified by the macro package automatically.} \label{fig1}
% \end{figure}
